---
description: ユーザーからの指摘事項を並列処理で調査・修正・レビューし完成させる
argument-hint: [指摘事項（複数可）]
---

# 指摘事項修正コマンド

## コンテキスト

- 現在のブランチ: !`git branch --show-current`
- 変更状態: !`git status --short`
- 最近のコミット: !`git log --oneline -3`

---

## ステップ0: ブランチ作成

**現在mainブランチにいる場合は、作業用ブランチを作成してください。**

```bash
git checkout -b fix/<作業内容を表す名前>
```

- mainブランチで直接作業しない
- ブランチ名は作業内容がわかる名前にする（例: `fix/review-feedback`, `fix/pr-comments`）

---

## 前提条件の確認

以下のサブエージェントの存在を確認してください：

| 必須 | エージェント種別 | 役割 |
|:---:|:---|:---|
| Yes | 調査系 | バグ調査や原因調査（例: `investigator`） |
| Yes | 実装系 | コード実装・修正（例: `implementer`） |
| Yes | レビュー系 | コード品質チェック（例: `code-reviewer`） |
| UI時 | スクショ撮影系 | 画面キャプチャ（例: `screenshot-taker`） |
| UI時 | 画面評価系 | UI評価（例: `ui-evaluator`） |

**存在しない場合**: ユーザーに報告し、指示を待つ

---

## 指摘事項

$ARGUMENTS

---

## 修正プロセス

### フェーズ1: 指摘事項の整理

1. **リスト化** - 指摘事項を分解し、IDを付与（#1, #2...）
2. **種別判定** - 「コードのみ」か「UI関連」かを判定

```
| ID | 指摘内容 | 種別 | 対象ファイル |
|----|----------|------|--------------|
| #1 | ... | コード/UI | ... |
```

---

### フェーズ2: 原因調査（並列処理）

**すべての指摘事項を並列で**調査系サブエージェントに投げる

各指摘について調査：
- 問題の根本原因
- 影響範囲
- 修正方針

---

### フェーズ3: 修正実装（並列処理）

**すべての指摘事項を並列で**実装系サブエージェントに投げる

**必須**: 修正には以下の形式でコメントを追加：

```
// [FIXED #ID] 指摘事項への対応
// 原因: [なぜこの問題が発生したか]
// 修正内容: [どのように修正したか]
// 経緯: [この実装方針を選んだ理由]
```

---

### フェーズ4: コードレビュー（並列処理）

**すべての修正を並列で**レビューサブエージェントに投げる

チェック項目：
- 指摘事項が正しく修正されているか
- 新たなバグが発生していないか
- コメントが適切に記載されているか

**問題あり** → フェーズ2に戻る（問題のある指摘のみ）
**問題なし** → UI指摘あり: フェーズ5へ / なし: フェーズ7へ

---

### フェーズ5: 画面確認（UI関連のみ・直列処理）

スクリーンショット撮影サブエージェントで**順番に**対象画面を撮影

---

### フェーズ6: 画面評価（並列処理）

**UI関連の指摘を並列で**画面評価サブエージェントに投げる

チェック項目：
- 指摘が視覚的に修正されているか
- デザインの一貫性が保たれているか

**問題あり** → フェーズ2に戻る（問題のある指摘のみ）
**問題なし** → フェーズ7へ

---

### フェーズ7: 完了報告

```
## 指摘事項修正完了

### 修正サマリ
| ID | 指摘内容 | 修正ファイル | 状態 |
|----|----------|--------------|------|

### 反復回数: [N]回

### 最終レビュー結果
- コードレビュー: [結果]
- 画面評価: [結果]（UI関連のみ）
```

---

### フェーズ8: Slack通知

`slack-notifier`サブエージェントで結果を共有

**メッセージ内容**:
- 修正した指摘事項一覧
- 変更ファイル
- 反復回数
- レビュー結果

**添付**: UI関連の場合はスクリーンショット

**注意**: `SLACK_TOKEN`と`SLACK_CHANNEL_ID`が未設定の場合はスキップ

---

## 並列処理ガイドライン

| フェーズ | 処理方式 | 理由 |
|:---|:---:|:---|
| 原因調査 | 並列 | 指摘事項は独立している |
| 修正実装 | 並列 | 指摘事項は独立している |
| コードレビュー | 並列 | 修正ごとに独立してレビュー可能 |
| スクショ撮影 | **直列** | 画面操作は順番に行う必要がある |
| 画面評価 | 並列 | 画像ごとに独立して評価可能 |

---

## 注意事項

- **経緯コメントは必須**: 修正時は必ず「なぜこの実装になったか」をコメントで残す
- **反復は最大5回まで**: それを超える場合はユーザーに相談
- **部分的な再実行**: 問題がある指摘事項のみをフェーズ2に戻す
- **大きな方針変更**: 指摘事項の解釈に迷う場合はユーザーに確認
